{"version":3,"sources":["../../src/JsonModel/makeDefaultIdValue.js"],"names":["makeDefaultIdValue","idCol","obj","uuid","v1","makeIdValue","value","slugValue","type","o","id","defaultIdValue","call"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,kBAAkB,GAAGC,KAAK,IAAIC,GAAG,IAAI;AAC1C,MAAIA,GAAG,CAACD,KAAD,CAAH,IAAc,IAAlB,EAAwB,OAAOC,GAAG,CAACD,KAAD,CAAV;AACxB,SAAOE,cAAKC,EAAL,EAAP;AACA,CAHD;;AAKO,MAAMC,WAAW,GAAG,CAACJ,KAAD,EAAQ;AAACK,EAAAA,KAAD;AAAQC,EAAAA,SAAR;AAAmBC,EAAAA;AAAnB,IAA2B,EAAnC,KAA0C;AACpE,MAAIA,IAAI,KAAK,SAAb,EAAwB;AACvB,WAAOF,KAAK,GACTA,KADS,GAETG,CAAC,IAAI;AACL,YAAMC,EAAE,GAAGD,CAAC,CAACR,KAAD,CAAZ;AACA,aAAOS,EAAE,IAAIA,EAAE,KAAK,CAAb,GAAiBA,EAAjB,GAAsB,IAA7B;AACC,KALJ;AAMA,GARmE,CASpE;;;AACA,MAAIH,SAAJ,EAAe;AACd,WAAO,gBAAeE,CAAf,EAAkB;AACxB,UAAIA,CAAC,CAACR,KAAD,CAAD,IAAY,IAAhB,EAAsB,OAAOQ,CAAC,CAACR,KAAD,CAAR;AACtB,aAAO,2BAAa,IAAb,GAAmB,MAAMM,SAAS,CAACE,CAAD,CAAlC,GAAuCR,KAAvC,CAAP;AACA,KAHD;AAIA;;AACD,QAAMU,cAAc,GAAGX,kBAAkB,CAACC,KAAD,CAAzC;;AACA,MAAIK,KAAJ,EAAW;AACV,WAAO,gBAAeG,CAAf,EAAkB;AACxB,UAAIA,CAAC,CAACR,KAAD,CAAD,IAAY,IAAhB,EAAsB,OAAOQ,CAAC,CAACR,KAAD,CAAR;AACtB,YAAMS,EAAE,GAAG,MAAMJ,KAAK,CAACM,IAAN,CAAW,IAAX,EAAiBH,CAAjB,CAAjB;AACA,aAAOC,EAAE,IAAI,IAAN,GAAaC,cAAc,CAACF,CAAD,CAA3B,GAAiCC,EAAxC;AACA,KAJD;AAKA;;AACD,SAAOC,cAAP;AACA,CAzBM","sourcesContent":["import uuid from 'uuid'\nimport {uniqueSlugId} from '../lib/slugify'\n\nconst makeDefaultIdValue = idCol => obj => {\n\tif (obj[idCol] != null) return obj[idCol]\n\treturn uuid.v1()\n}\n\nexport const makeIdValue = (idCol, {value, slugValue, type} = {}) => {\n\tif (type === 'INTEGER') {\n\t\treturn value\n\t\t\t? value\n\t\t\t: o => {\n\t\t\t\t\tconst id = o[idCol]\n\t\t\t\t\treturn id || id === 0 ? id : null\n\t\t\t  }\n\t}\n\t// do not bind the value functions, they must be able to use other db during migrations\n\tif (slugValue) {\n\t\treturn async function(o) {\n\t\t\tif (o[idCol] != null) return o[idCol]\n\t\t\treturn uniqueSlugId(this, await slugValue(o), idCol)\n\t\t}\n\t}\n\tconst defaultIdValue = makeDefaultIdValue(idCol)\n\tif (value) {\n\t\treturn async function(o) {\n\t\t\tif (o[idCol] != null) return o[idCol]\n\t\t\tconst id = await value.call(this, o)\n\t\t\treturn id == null ? defaultIdValue(o) : id\n\t\t}\n\t}\n\treturn defaultIdValue\n}\n"],"file":"makeDefaultIdValue.js"}